!function (a) { a.fn.zyUpload = function (b) { var e, d = Array.prototype.slice.call(arguments, 1); if ("string" == typeof b) { if (e = this[0][b], a.isFunction(e)) return e.apply(this, d); throw "zyUpload - No such method: " + b } return this.each(function () { var c = {}, d = this, e = { width: "700px", height: "400px", itemWidth: "140px", itemHeight: "120px", url: "/upload/UploadAction", multiple: !0, dragDrop: !0, del: !0, finishDel: !1, onSelect: function () { }, onDelete: function () { }, onSuccess: function () { }, onFailure: function () { }, onComplete: function () { } }; c = a.extend(e, b), this.init = function () { this.createHtml(), this.createCorePlug() }, this.createHtml = function () { var e, f, b = ""; b = c.multiple ? "multiple" : "", e = "", c.dragDrop ? (e += '<form id="uploadForm" action="' + c.url + '" method="post" enctype="multipart/form-data">', e += '	<div class="upload_box">', e += '		<div class="upload_main">', e += '			<div class="upload_choose" style="min-height: 140px;">', e += '				<div class="convent_choice">', e += '					<div class="andArea">', e += '						<div class="filePicker">点击选择文件</div>', e += '						<input id="fileImage" type="file" size="30" name="fileselect[]" ' + b + ">", e += "					</div>", e += "				</div>", e += '				<span id="fileDragArea" class="upload_drag_area" style="min-height: 120px;">或者将文件拖到此处</span>', e += "			</div>", e += '			<div class="status_bar">', e += '				<div id="status_info" class="info">选中0张文件，共0B。</div>', e += '				<div class="btns">', e += '					<div class="webuploader_pick" style="display:none;">继续选择</div>', e += '					<div class="upload_btn" style="display:none;">开始上传</div>', e += "				</div>", e += "			</div>", e += '			<div id="preview" class="upload_preview" style="padding-left: 0px;margin-left: 0px;width: 100%;"></div>', e += "		</div>", e += '		<div class="upload_submit">', e += '			<button type="button" id="fileSubmit" class="upload_submit_btn">确认上传文件</button>', e += "		</div>", e += '		<div id="uploadInf" class="upload_inf"></div>', e += "	</div>", e += "</form>") : (f = parseInt(c.itemWidth.replace("px", "")) - 15, e += '<form id="uploadForm" action="' + c.url + '" method="post" enctype="multipart/form-data">', e += '	<div class="upload_box">', e += '		<div class="upload_main single_main">', e += '			<div class="status_bar">', e += '				<div id="status_info" class="info">选中0张文件，共0B。</div>', e += '				<div class="btns">', e += '					<input id="fileImage" type="file" size="30" name="fileselect[]" ' + b + ">", e += '					<div class="webuploader_pick">选择文件</div>', e += '					<div class="upload_btn">开始上传</div>', e += "				</div>", e += "			</div>", e += '			<div id="preview" class="upload_preview">', e += '				<div class="add_upload">', e += '					<a style="height:' + c.itemHeight + ";width:" + c.itemWidth + ';" title="点击添加文件" id="rapidAddImg" class="add_imgBox" href="javascript:void(0)">', e += '						<div class="uploadImg" style="width:' + f + 'px">', e += '							<img class="upload_image" src="control/images/add_img.png" style="width:expression(this.width > ' + f + " ? " + f + 'px : this.width)" />', e += "						</div>", e += "					</a>", e += "				</div>", e += "			</div>", e += "		</div>", e += '		<div class="upload_submit">', e += '			<button type="button" id="fileSubmit" class="upload_submit_btn">确认上传文件</button>', e += "		</div>", e += '		<div id="uploadInf" class="upload_inf"></div>', e += "	</div>", e += "</form>"), a(d).append(e).css({ width: c.width, height: c.height }), this.addEvent() }, this.funSetStatusInfo = function (b) { var c = 0, d = b.length; a.each(b, function (a, b) { c += b.size }), c = c > 1048576 ? (Math.round(100 * c / 1048576) / 100).toString() + "MB" : (Math.round(100 * c / 1024) / 100).toString() + "KB", a("#status_info").html("选中" + d + "张文件，共" + c + "。") }, this.funFilterEligibleFile = function (a) { var d, c, b = []; for (c = 0; d = a[c]; c++) d.size >= 512e5 ? alert('您这个"' + d.name + '"文件大小过大') : b.push(d); return b }, this.funDisposePreviewHtml = function (a, b) { var g, d = "", e = parseInt(c.itemWidth.replace("px", "")) - 15, f = ""; return c.del && (f = '<span class="file_del" data-index="' + a.index + '" title="删除"></span>'), g = "control/images/fileType/", g += a.type.indexOf("rar") > 0 ? "rar.png" : a.type.indexOf("zip") > 0 ? "zip.png" : a.type.indexOf("text") > 0 ? "txt.png" : "file.png", 0 == a.type.indexOf("image") ? (d += '<div id="uploadList_' + a.index + '" class="upload_append_list">', d += '	<div class="file_bar">', d += '		<div style="padding:5px;">', d += '			<p class="file_name">' + a.name + "</p>", d += f, d += "		</div>", d += "	</div>", d += '	<a style="height:' + c.itemHeight + ";width:" + c.itemWidth + ';" href="#" class="imgBox">', d += '		<div class="uploadImg" style="width:' + e + 'px">', d += '			<img id="uploadImage_' + a.index + '" class="upload_image" src="' + b.target.result + '" style="width:expression(this.width > ' + e + " ? " + e + 'px : this.width)" />', d += "		</div>", d += "	</a>", d += '	<p id="uploadProgress_' + a.index + '" class="file_progress"></p>', d += '	<p id="uploadFailure_' + a.index + '" class="file_failure">上传失败，请重试</p>', d += '	<p id="uploadSuccess_' + a.index + '" class="file_success"></p>', d += "</div>") : (d += '<div id="uploadList_' + a.index + '" class="upload_append_list">', d += '	<div class="file_bar">', d += '		<div style="padding:5px;">', d += '			<p class="file_name">' + a.name + "</p>", d += f, d += "		</div>", d += "	</div>", d += '	<a style="height:' + c.itemHeight + ";width:" + c.itemWidth + ';" href="#" class="imgBox">', d += '		<div class="uploadImg" style="width:' + e + 'px">', d += '			<img id="uploadImage_' + a.index + '" class="upload_image" src="' + g + '" style="width:expression(this.width > ' + e + " ? " + e + 'px : this.width)" />', d += "		</div>", d += "	</a>", d += '	<p id="uploadProgress_' + a.index + '" class="file_progress"></p>', d += '	<p id="uploadFailure_' + a.index + '" class="file_failure">上传失败，请重试</p>', d += '	<p id="uploadSuccess_' + a.index + '" class="file_success"></p>', d += "</div>"), d }, this.createCorePlug = function () { var b = { fileInput: a("#fileImage").get(0), uploadInput: a("#fileSubmit").get(0), dragDrop: a("#fileDragArea").get(0), url: a("#uploadForm").attr("action"), filterFile: function (a) { return d.funFilterEligibleFile(a) }, onSelect: function (b, e) { var f, g, h, i, j, k; c.onSelect(b, e), d.funSetStatusInfo(ZYFILE.funReturnNeedFiles()), f = "", g = 0, h = function () { if (file = b[g]) { var a = new FileReader; a.onload = function (a) { f += d.funDisposePreviewHtml(file, a), g++, h() }, a.readAsDataURL(file) } else i(f) }, i = function (b) { c.dragDrop ? a("#preview").append(b) : a(".add_upload").before(b), j(), k() }, j = function () { a(".file_del").length > 0 && a(".file_del").click(function () { return ZYFILE.funDeleteFile(parseInt(a(this).attr("data-index")), !0), !1 }), a(".file_edit").length > 0 && a(".file_edit").click(function () { return !1 }) }, k = function () { a(".upload_append_list").hover(function () { a(this).find(".file_bar").addClass("file_hover") }, function () { a(this).find(".file_bar").removeClass("file_hover") }) }, h() }, onDelete: function (b, e) { c.onDelete(b, e), a("#uploadList_" + b.index).fadeOut(), d.funSetStatusInfo(e) }, onProgress: function (b, c, d) { var e = a("#uploadProgress_" + b.index), f = (100 * (c / d)).toFixed(2) + "%"; e.is(":hidden") && e.show(), e.css("width", f) }, onSuccess: function (b, e) { a("#uploadProgress_" + b.index).hide(), a("#uploadSuccess_" + b.index).show(), a("#uploadInf").append("<p>上传成功，文件地址是：" + e + "</p>"), c.finishDel && (a("#uploadList_" + b.index).fadeOut(), d.funSetStatusInfo(ZYFILE.funReturnNeedFiles())) }, onFailure: function (b) { a("#uploadProgress_" + b.index).hide(), a("#uploadSuccess_" + b.index).show(), a("#uploadInf").append("<p>文件" + b.name + "上传失败！</p>") }, onComplete: function (a) { console.info(a) }, onDragOver: function () { a(this).addClass("upload_drag_hover") }, onDragLeave: function () { a(this).removeClass("upload_drag_hover") } }; ZYFILE = a.extend(ZYFILE, b), ZYFILE.init() }, this.addEvent = function () { a(".filePicker").length > 0 && a(".filePicker").on({ click: function () { a("#fileImage").click() } }), a(".webuploader_pick").bind("click", function () { a("#fileImage").click() }), a(".upload_btn").bind("click", function () { ZYFILE.funReturnNeedFiles().length > 0 ? a("#fileSubmit").click() : alert("请先选中文件再点击上传") }), a("#rapidAddImg").length > 0 && a("#rapidAddImg").bind("click", function () { a("#fileImage").click() }) }, this.init() }) } }(jQuery);